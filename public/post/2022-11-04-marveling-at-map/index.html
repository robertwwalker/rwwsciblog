<!DOCTYPE HTML>

<html lang='en'>
	<head>
		<title>Marveling at map() &middot; rww-science: the blog</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		
		
		
		<link rel="stylesheet" href="/assets/css/main.min.css">
		
		
		
		<noscript><link rel="stylesheet" href='/assets/css/noscript.css' /></noscript>
	</head>

	<body lang='en' class="is-preload">

		
			<div id="wrapper">

                
<header id="header">
    <a href='/' class="logo">rww-science: the blog</a>
</header>

                

<nav id="nav">
    <ul class="links">
        <li class="active"><a href='/'>rww-science: the blog</a></li>
        
        <li><a href='/#footer'>Contact</a></li>
        
        
    </ul>
    
    <ul class="icons">
        
        <li><a href="https://twitter.com/PieRatio" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
        
        
        <li><a href="https://facebook.com" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
        
        
        <li><a href="https://instagram.com" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
        
        
        <li><a href="https://www.linkedin.com" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
        
        
        <li><a href="https://github.com/robertwwalker" class="icon fa-github"><span class="label">GitHub</span></a></li>
        
        
        <li><a href="https://youtube.com/" class="icon fa-youtube"><span class="label">Youtube</span></a></li>
        
        
        <li><a href="https://plus.google.com/" class="icon fa-google-plus"><span class="label">Google Plus</span></a></li>
        
        
        <li><a href="https://last.fm/" class="icon fa-lastfm"><span class="label">Last.fm</span></a></li>
        
        
        <li><a href="https://flickr.com/" class="icon fa-flickr"><span class="label">Flickr</span></a></li>
        
    </ul>
    
</nav>


				
					<div id="main">

						
                        <section class="post">
                            <header class="major">
                                
                                <span class="date">November 4, 2022</span>
                                
                                <h1>Marveling at map()</h1>
                                <p></p>
                            </header>
                            
                            <p><strong>I want to learn about map and begin to replace my use of apply for everything.</strong></p>
<p>Goal: import a directory full of csv files.</p>
<p>Method.  First, load <code>purrr</code> and the <code>tidyverse</code> and then create a tibble for the <em>filenames</em> because we are creating the example.  <code>map</code> wants to output a list so I have to unlist it into the tibble.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(tidyverse)
<span style="color:#a6e22e">library</span>(purrr)
<span style="color:#75715e"># Create a set of filenames</span>
fnames <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tibble</span>(
  filenames<span style="color:#f92672">=</span><span style="color:#a6e22e">unlist</span>(
  <span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>), 
      <span style="color:#f92672">~</span><span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;file&#34;</span>,.x,<span style="color:#e6db74">&#34;.csv&#34;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)
      )))
fnames
</code></pre></div><pre><code>## # A tibble: 5 Ã— 1
##   filenames
##   &lt;chr&gt;    
## 1 file1.csv
## 2 file2.csv
## 3 file3.csv
## 4 file4.csv
## 5 file5.csv
</code></pre><h2 id="create-the-files">Create the files</h2>
<p>Now I need to create some files in a given directory.  I have created a directory called <em>fakedata</em>.</p>
<pre><code>dir.create(&quot;fakedata&quot;)
</code></pre><p>Now I want to write the data to the directory to conclude the reproducible example.  In this case, there are five csv files.</p>
<pre><code>walk(fnames$filenames, 
     ~ write.csv(data.frame(x1=rnorm(10),x2=rnorm(10)),       file = paste0(&quot;./fakedata/&quot;,.x, sep=&quot;&quot;)))
</code></pre><p>That seems to work.</p>
<p>![Photo of success](img/Screen Shot 2022-11-04 at 12.58.16 PM.png)</p>
<h2 id="loading-the-files">Loading the files</h2>
<p>Though I already know the names of the files, in most cases, I would need to collect them.  In this particular case, <code>dir()</code> will come in very handy.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">dir</span>(<span style="color:#e6db74">&#34;fakedata&#34;</span>)
</code></pre></div><pre><code>## [1] &quot;file1.csv&quot; &quot;file2.csv&quot; &quot;file3.csv&quot; &quot;file4.csv&quot; &quot;file5.csv&quot;
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">file.names <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dir</span>(<span style="color:#e6db74">&#34;fakedata&#34;</span>)
</code></pre></div><p>Now let&rsquo;s take those and load the files.  We will combine <code>read.csv</code> with <code>map</code> to get a list containing all of the files.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">read.files <span style="color:#f92672">&lt;-</span> file.names <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">map</span>(., <span style="color:#f92672">~</span> <span style="color:#a6e22e">read.csv</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;fakedata/&#34;</span>,.x, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)))
read.files
</code></pre></div><pre><code>## [[1]]
##     X          x1          x2
## 1   1 -1.38001285 -1.22636540
## 2   2  0.18200309 -0.47330201
## 3   3  0.38672920  0.32228012
## 4   4  1.59951536  0.17438280
## 5   5  0.04066402 -2.17050573
## 6   6 -0.25814383  0.35882778
## 7   7 -1.09942888  0.05209077
## 8   8 -0.96198031 -0.31535964
## 9   9 -0.71146188 -0.88743843
## 10 10 -0.90768963 -1.64463965
## 
## [[2]]
##     X          x1          x2
## 1   1 -0.93160098  0.38577793
## 2   2 -1.11500843 -2.28599247
## 3   3  0.48695836 -0.38091065
## 4   4  0.43833164  1.94491090
## 5   5  1.38558361  0.29454227
## 6   6 -0.08697636  0.14269709
## 7   7  1.32351741  0.29570675
## 8   8 -0.51831633 -1.07216871
## 9   9 -0.51175809  0.01959317
## 10 10  0.89500573 -1.03716777
## 
## [[3]]
##     X         x1          x2
## 1   1 -0.8834481 -0.25006254
## 2   2  1.0708784 -1.36573365
## 3   3  0.3286340 -0.10929292
## 4   4  1.2088226 -0.04355173
## 5   5 -0.5257318 -0.47974675
## 6   6  3.0484664 -0.32511134
## 7   7 -0.2252273  1.23925377
## 8   8  1.0458161 -1.18513179
## 9   9  0.3243315  1.44062060
## 10 10  0.8238747 -1.53231879
## 
## [[4]]
##     X         x1          x2
## 1   1  0.8460534  0.08150364
## 2   2 -0.3220720  1.07239215
## 3   3  1.3478005  1.18462705
## 4   4  0.9222565  1.16223158
## 5   5  1.1380822  1.05890088
## 6   6  0.6123547 -1.46789361
## 7   7 -0.2974722 -0.37149873
## 8   8  1.0321546  0.15357759
## 9   9 -0.3445316 -0.95253704
## 10 10 -0.1112015 -0.64225964
## 
## [[5]]
##     X          x1          x2
## 1   1 -1.15093999  0.54168693
## 2   2  0.35413293 -0.09396014
## 3   3 -1.26696402  0.25582265
## 4   4  0.06712394  1.23749986
## 5   5  0.53648590  0.37711498
## 6   6 -1.29457309  0.23440024
## 7   7  0.44966760  0.45751493
## 8   8 -0.42755728  0.89952539
## 9   9 -0.06584558  0.09520603
## 10 10 -0.50046918 -0.16258746
</code></pre><p>Let me stick the filenames on the list elements.  This allows any individual one to be addressed in a relatively intuitive way.  I show an example by calculating the mean of x1 in the third dataset.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">clean.files <span style="color:#f92672">&lt;-</span> read.files
<span style="color:#a6e22e">names</span>(clean.files) <span style="color:#f92672">&lt;-</span> file.names
clean.files
</code></pre></div><pre><code>## $file1.csv
##     X          x1          x2
## 1   1 -1.38001285 -1.22636540
## 2   2  0.18200309 -0.47330201
## 3   3  0.38672920  0.32228012
## 4   4  1.59951536  0.17438280
## 5   5  0.04066402 -2.17050573
## 6   6 -0.25814383  0.35882778
## 7   7 -1.09942888  0.05209077
## 8   8 -0.96198031 -0.31535964
## 9   9 -0.71146188 -0.88743843
## 10 10 -0.90768963 -1.64463965
## 
## $file2.csv
##     X          x1          x2
## 1   1 -0.93160098  0.38577793
## 2   2 -1.11500843 -2.28599247
## 3   3  0.48695836 -0.38091065
## 4   4  0.43833164  1.94491090
## 5   5  1.38558361  0.29454227
## 6   6 -0.08697636  0.14269709
## 7   7  1.32351741  0.29570675
## 8   8 -0.51831633 -1.07216871
## 9   9 -0.51175809  0.01959317
## 10 10  0.89500573 -1.03716777
## 
## $file3.csv
##     X         x1          x2
## 1   1 -0.8834481 -0.25006254
## 2   2  1.0708784 -1.36573365
## 3   3  0.3286340 -0.10929292
## 4   4  1.2088226 -0.04355173
## 5   5 -0.5257318 -0.47974675
## 6   6  3.0484664 -0.32511134
## 7   7 -0.2252273  1.23925377
## 8   8  1.0458161 -1.18513179
## 9   9  0.3243315  1.44062060
## 10 10  0.8238747 -1.53231879
## 
## $file4.csv
##     X         x1          x2
## 1   1  0.8460534  0.08150364
## 2   2 -0.3220720  1.07239215
## 3   3  1.3478005  1.18462705
## 4   4  0.9222565  1.16223158
## 5   5  1.1380822  1.05890088
## 6   6  0.6123547 -1.46789361
## 7   7 -0.2974722 -0.37149873
## 8   8  1.0321546  0.15357759
## 9   9 -0.3445316 -0.95253704
## 10 10 -0.1112015 -0.64225964
## 
## $file5.csv
##     X          x1          x2
## 1   1 -1.15093999  0.54168693
## 2   2  0.35413293 -0.09396014
## 3   3 -1.26696402  0.25582265
## 4   4  0.06712394  1.23749986
## 5   5  0.53648590  0.37711498
## 6   6 -1.29457309  0.23440024
## 7   7  0.44966760  0.45751493
## 8   8 -0.42755728  0.89952539
## 9   9 -0.06584558  0.09520603
## 10 10 -0.50046918 -0.16258746
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">clean.files<span style="color:#f92672">$</span>file3.csv <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">mean</span>(x1))
</code></pre></div><pre><code>##    mean(x1)
## 1 0.6216417
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">mean</span>(read.files[[3]]<span style="color:#f92672">$</span>x1)
</code></pre></div><pre><code>## [1] 0.6216417
</code></pre><p>If every spreadsheet happened to be the same, as these are, then we could also stack them.  There is a danger to the renaming because of the way it works with unlist.  Sticking with the original file, they are straightforward to stack using <code>map_dfr()</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stacked.files <span style="color:#f92672">&lt;-</span> file.names <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">map_dfr</span>(., <span style="color:#f92672">~</span> <span style="color:#a6e22e">read.csv</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;fakedata/&#34;</span>,.x, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>)))
stacked.files
</code></pre></div><pre><code>##     X          x1          x2
## 1   1 -1.38001285 -1.22636540
## 2   2  0.18200309 -0.47330201
## 3   3  0.38672920  0.32228012
## 4   4  1.59951536  0.17438280
## 5   5  0.04066402 -2.17050573
## 6   6 -0.25814383  0.35882778
## 7   7 -1.09942888  0.05209077
## 8   8 -0.96198031 -0.31535964
## 9   9 -0.71146188 -0.88743843
## 10 10 -0.90768963 -1.64463965
## 11  1 -0.93160098  0.38577793
## 12  2 -1.11500843 -2.28599247
## 13  3  0.48695836 -0.38091065
## 14  4  0.43833164  1.94491090
## 15  5  1.38558361  0.29454227
## 16  6 -0.08697636  0.14269709
## 17  7  1.32351741  0.29570675
## 18  8 -0.51831633 -1.07216871
## 19  9 -0.51175809  0.01959317
## 20 10  0.89500573 -1.03716777
## 21  1 -0.88344806 -0.25006254
## 22  2  1.07087838 -1.36573365
## 23  3  0.32863403 -0.10929292
## 24  4  1.20882258 -0.04355173
## 25  5 -0.52573184 -0.47974675
## 26  6  3.04846641 -0.32511134
## 27  7 -0.22522727  1.23925377
## 28  8  1.04581612 -1.18513179
## 29  9  0.32433151  1.44062060
## 30 10  0.82387468 -1.53231879
## 31  1  0.84605339  0.08150364
## 32  2 -0.32207204  1.07239215
## 33  3  1.34780048  1.18462705
## 34  4  0.92225652  1.16223158
## 35  5  1.13808219  1.05890088
## 36  6  0.61235469 -1.46789361
## 37  7 -0.29747222 -0.37149873
## 38  8  1.03215455  0.15357759
## 39  9 -0.34453156 -0.95253704
## 40 10 -0.11120152 -0.64225964
## 41  1 -1.15093999  0.54168693
## 42  2  0.35413293 -0.09396014
## 43  3 -1.26696402  0.25582265
## 44  4  0.06712394  1.23749986
## 45  5  0.53648590  0.37711498
## 46  6 -1.29457309  0.23440024
## 47  7  0.44966760  0.45751493
## 48  8 -0.42755728  0.89952539
## 49  9 -0.06584558  0.09520603
## 50 10 -0.50046918 -0.16258746
</code></pre>

                            
                            
                            
                            
                            
                        </section>

					</div>

                    

<footer id="footer">
    
    <section>
      <form method="post" action="post-action">
        <div class="fields">
          <div class="field">
            <label for="name">Name</label>
            <input type="text" name="name" id="name" />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input type="text" name="email" id="email" />
          </div>
          <div class="field">
            <label for="message">Message</label>
            <textarea name="message" id="message" rows="3"></textarea>
          </div>
        </div>
        <ul class="actions">
          <li><input type="submit" value='Send A Message' /></li>
        </ul>
      </form>
    </section>
    
    <section class="split contact">
        
        <section class="alt">
            <h3>Address</h3>
            <p>
                
                     900 State St
                
                     <br/>  Salem, OR 97301
                
            </p>
        </section>
        
        
        <section>
            <h3>Phone</h3>
            <p><a href="tel:%28503%29%20375-6475">(503) 375-6475</a></p>
        </section>
        
        
        <section>
            <h3>Email</h3>
            <p><a href="mailto:rwalker@willamette.edu">rwalker@willamette.edu</a></p>
        </section>
        
        
        <section>
            <h3>Social</h3>
            <ul class="icons alt">
                
                <li><a href="https://twitter.com/PieRatio" class="icon alt fa-twitter"><span class="label">Twitter</span></a></li>
                
                
                <li><a href="https://facebook.com" class="icon alt fa-facebook"><span class="label">Facebook</span></a></li>
                
                
                <li><a href="https://instagram.com" class="icon alt fa-instagram"><span class="label">Instagram</span></a></li>
                
                
                <li><a href="https://www.linkedin.com" class="icon alt fa-linkedin"><span class="label">LinkedIn</span></a></li>
                
                
                <li><a href="https://github.com/robertwwalker" class="icon alt fa-github"><span class="label">GitHub</span></a></li>
                
                
                <li><a href="https://youtube.com/" class="icon alt fa-youtube"><span class="label">Youtube</span></a></li>
                
                
                <li><a href="https://plus.google.com/" class="icon alt fa-google-plus"><span class="label">Google Plus</span></a></li>
                
                
                <li><a href="https://last.fm/" class="icon alt fa-lastfm"><span class="label">Last.fm</span></a></li>
                
                
                <li><a href="https://flickr.com/" class="icon alt fa-flickr"><span class="label">Flickr</span></a></li>
                
            </ul>
        </section>
        
    </section>
    <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</footer>

                    
<div id="copyright">
    <ul><li>&copy; rww-science: the blog</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li><li>Hugo Port: <a href="https://curtistimson.co.uk">curttimson</a></li></ul>
</div>


            </div>
            
            










<script src='/assets/js/bundle.js'></script>


	</body>
</html>
