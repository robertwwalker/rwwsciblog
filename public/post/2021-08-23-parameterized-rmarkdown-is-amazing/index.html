<!DOCTYPE HTML>

<html lang='en'>
	<head>
		<title>Parameterized RMarkdown is Amazing &middot; rww-science: the blog</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		
		
		
		<link rel="stylesheet" href="/assets/css/main.min.css">
		
		
		
		<noscript><link rel="stylesheet" href='/assets/css/noscript.css' /></noscript>
	</head>

	<body lang='en' class="is-preload">

		
			<div id="wrapper">

                
<header id="header">
    <a href='/' class="logo">rww-science: the blog</a>
</header>

                

<nav id="nav">
    <ul class="links">
        <li class="active"><a href='/'>rww-science: the blog</a></li>
        
        <li><a href='/#footer'>Contact</a></li>
        
        
    </ul>
    
    <ul class="icons">
        
        <li><a href="https://twitter.com/PieRatio" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
        
        
        <li><a href="https://facebook.com" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
        
        
        <li><a href="https://instagram.com" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
        
        
        <li><a href="https://www.linkedin.com" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
        
        
        <li><a href="https://github.com/robertwwalker" class="icon fa-github"><span class="label">GitHub</span></a></li>
        
        
        <li><a href="https://youtube.com/" class="icon fa-youtube"><span class="label">Youtube</span></a></li>
        
        
        <li><a href="https://plus.google.com/" class="icon fa-google-plus"><span class="label">Google Plus</span></a></li>
        
        
        <li><a href="https://last.fm/" class="icon fa-lastfm"><span class="label">Last.fm</span></a></li>
        
        
        <li><a href="https://flickr.com/" class="icon fa-flickr"><span class="label">Flickr</span></a></li>
        
    </ul>
    
</nav>


				
					<div id="main">

						
                        <section class="post">
                            <header class="major">
                                
                                <span class="date">August 23, 2021</span>
                                
                                <h1>Parameterized RMarkdown is Amazing</h1>
                                <p></p>
                            </header>
                            
                            
<script src="https://rww-science.website/post/2021-08-23-parameterized-rmarkdown-is-amazing/index_files/header-attrs/header-attrs.js"></script>


<div id="parameterized-r-markdown" class="section level1">
<h1>Parameterized R Markdown</h1>
<p>A while back, I learned that you can parameterize markdown. You can send it something to process as argument. This is amazing. Let me show an example.</p>
<p>First, I want to build an RMarkdown file. In <em>RStudio</em>, that is <code>File &gt; New file &gt; R Markdown</code>.</p>
<p>We will need to add a bit of metadata to the top. The key component is the <code>params:</code> argument. I want to pass a <code>ticker</code> with a default option.</p>
<p><img src="pic/yaml.png" /></p>
<p>Now, let’s build up an example.</p>
<p>I want to load a few libraries.</p>
<pre><code>library(tidyquant)
library(ggplot2)
library(fpp3)</code></pre>
<p>Without loading anything else, this markdown is aware of what I passed it in <code>params$ticker</code>. But <code>tidyquant</code> can make use of tickers and retrieve market OHLC data. So let me proxy that behavior with Goldman Sachs as the example.</p>
<pre class="r"><code>params &lt;- NULL
params$ticker &lt;- &quot;GS&quot;</code></pre>
<p>Now my environment looks the same. Let me use <code>tq_get</code> to get the data.</p>
<pre class="r"><code>dat &lt;- tq_get(params$ticker)</code></pre>
<p>Now I want to use a special <em>geometry</em> for OHLC data. I will also give it a title that deploys the ticker and use the special theme.</p>
<pre class="r"><code>dat %&gt;% ggplot(aes(x = date, y = close)) +
    geom_barchart(aes(open = open, high = high, low = low, close = close)) +
    labs(title = paste(params$ticker,&quot;Bar Chart&quot;), y = &quot;Closing Price&quot;, x = &quot;&quot;) + 
    theme_tq()</code></pre>
<p><img src="https://rww-science.website/post/2021-08-23-parameterized-rmarkdown-is-amazing/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Let’s look at a smooth with a simple 50 day moving average.</p>
<pre class="r"><code>dat %&gt;%
    ggplot(aes(x = date, y = close)) +
    geom_line() +           # Plot stock price
    geom_bbands(aes(high = high, low = low, close = close), ma_fun = SMA, n = 50)</code></pre>
<p><img src="https://rww-science.website/post/2021-08-23-parameterized-rmarkdown-is-amazing/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>We can also invoke <code>tidyquant</code> functions of the data, like returns or more complicated financial quantities.</p>
<pre class="r"><code>dat %&gt;% tq_transmute(select= adjusted, 
                 mutate_fun = periodReturn, 
                 period     = &quot;daily&quot;, 
                 col_rename = &quot;Ra&quot;) %&gt;% 
  as_tsibble(index=date) %&gt;% 
  autoplot()</code></pre>
<pre><code>## Warning: `type_convert()` only converts columns of type &#39;character&#39;.
## - `df` has no columns of type &#39;character&#39;</code></pre>
<pre><code>## Plot variable not specified, automatically selected `.vars = Ra`</code></pre>
<p><img src="https://rww-science.website/post/2021-08-23-parameterized-rmarkdown-is-amazing/index_files/figure-html/PlotRet-1.png" width="672" /></p>
<p>After I have the model report written, I can save the file and stop. The key is to note the file name and the full path. I will store mine in whatever my current working directory is. I want two more libraries; I need the <code>rmarkdown</code> library to <em>render</em> the file and I need the <code>purrr</code> library to <em>map</em> my tickers into render. I created a little function for this called <code>Equity.Analyser</code> to simplify my use of map. <code>tidyquant</code> has a function for acquiring all of the basic data on members of an index or exchange. I want to choose the S and P 400 and then generate a report for each one. The one trick is that I need a simple vector to pass to map so I unlist the column. This produced nearly 370 little reports in about 10 minutes.</p>
<pre><code>library(rmarkdown)
library(purrr)
Equity.Analyser &lt;- function(x) {
  render(&quot;TQ-Parameters.Rmd&quot;, params = list(ticker = x), output_file = paste0(x,&quot;-TQ-Parameters.html&quot;))
}
SP400 &lt;- tq_index(&quot;SP400&quot;) 
SP400 %&gt;% select(symbol) %&gt;% unlist() %&gt;% map(., Equity.Analyser)</code></pre>
</div>


                            
                            
                            
                            
                            
                        </section>

					</div>

                    

<footer id="footer">
    
    <section>
      <form method="post" action="post-action">
        <div class="fields">
          <div class="field">
            <label for="name">Name</label>
            <input type="text" name="name" id="name" />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input type="text" name="email" id="email" />
          </div>
          <div class="field">
            <label for="message">Message</label>
            <textarea name="message" id="message" rows="3"></textarea>
          </div>
        </div>
        <ul class="actions">
          <li><input type="submit" value='Send A Message' /></li>
        </ul>
      </form>
    </section>
    
    <section class="split contact">
        
        <section class="alt">
            <h3>Address</h3>
            <p>
                
                     900 State St
                
                     <br/>  Salem, OR 97301
                
            </p>
        </section>
        
        
        <section>
            <h3>Phone</h3>
            <p><a href="tel:%28503%29%20375-6475">(503) 375-6475</a></p>
        </section>
        
        
        <section>
            <h3>Email</h3>
            <p><a href="mailto:rwalker@willamette.edu">rwalker@willamette.edu</a></p>
        </section>
        
        
        <section>
            <h3>Social</h3>
            <ul class="icons alt">
                
                <li><a href="https://twitter.com/PieRatio" class="icon alt fa-twitter"><span class="label">Twitter</span></a></li>
                
                
                <li><a href="https://facebook.com" class="icon alt fa-facebook"><span class="label">Facebook</span></a></li>
                
                
                <li><a href="https://instagram.com" class="icon alt fa-instagram"><span class="label">Instagram</span></a></li>
                
                
                <li><a href="https://www.linkedin.com" class="icon alt fa-linkedin"><span class="label">LinkedIn</span></a></li>
                
                
                <li><a href="https://github.com/robertwwalker" class="icon alt fa-github"><span class="label">GitHub</span></a></li>
                
                
                <li><a href="https://youtube.com/" class="icon alt fa-youtube"><span class="label">Youtube</span></a></li>
                
                
                <li><a href="https://plus.google.com/" class="icon alt fa-google-plus"><span class="label">Google Plus</span></a></li>
                
                
                <li><a href="https://last.fm/" class="icon alt fa-lastfm"><span class="label">Last.fm</span></a></li>
                
                
                <li><a href="https://flickr.com/" class="icon alt fa-flickr"><span class="label">Flickr</span></a></li>
                
            </ul>
        </section>
        
    </section>
    <script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</footer>

                    
<div id="copyright">
    <ul><li>&copy; rww-science: the blog</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li><li>Hugo Port: <a href="https://curtistimson.co.uk">curttimson</a></li></ul>
</div>


            </div>
            
            










<script src='/assets/js/bundle.js'></script>


	</body>
</html>
